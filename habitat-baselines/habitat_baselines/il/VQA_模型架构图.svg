<svg width="900" height="700" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 18px; font-weight: bold; text-anchor: middle; }
      .label { font-family: Arial, sans-serif; font-size: 12px; text-anchor: middle; }
      .small-label { font-family: Arial, sans-serif; font-size: 10px; text-anchor: middle; }
      .input { fill: #e3f2fd; stroke: #1976d2; stroke-width: 2; }
      .cnn { fill: #f3e5f5; stroke: #7b1fa2; stroke-width: 2; }
      .lstm { fill: #e8f5e8; stroke: #388e3c; stroke-width: 2; }
      .attention { fill: #fff3e0; stroke: #f57c00; stroke-width: 2; }
      .fusion { fill: #fce4ec; stroke: #c2185b; stroke-width: 2; }
      .output { fill: #f1f8e9; stroke: #689f38; stroke-width: 2; }
      .arrow { stroke: #333; stroke-width: 2; marker-end: url(#arrowhead); }
      .data-flow { stroke: #666; stroke-width: 1.5; stroke-dasharray: 3,3; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="450" y="25" class="title">VQA模型架构 (VqaLstmCnnAttentionModel)</text>
  
  <!-- Image Input Branch -->
  <text x="150" y="60" class="label">图像序列分支</text>
  
  <rect x="50" y="80" width="100" height="40" class="input" />
  <text x="100" y="105" class="label">图像序列</text>
  <text x="100" y="115" class="small-label">(T, 3, H, W)</text>
  
  <rect x="50" y="150" width="100" height="40" class="cnn" />
  <text x="100" y="175" class="label">CNN特征</text>
  <text x="100" y="185" class="small-label">(T, 512)</text>
  
  <rect x="50" y="220" width="100" height="60" class="lstm" />
  <text x="100" y="245" class="label">LSTM编码器</text>
  <text x="100" y="255" class="small-label">hidden_size</text>
  <text x="100" y="265" class="small-label">= 512</text>
  
  <!-- Question Input Branch -->
  <text x="350" y="60" class="label">问题文本分支</text>
  
  <rect x="300" y="80" width="100" height="40" class="input" />
  <text x="350" y="105" class="label">问题文本</text>
  <text x="350" y="115" class="small-label">(Q_len,)</text>
  
  <rect x="300" y="150" width="100" height="40" class="lstm" />
  <text x="350" y="175" class="label">词嵌入</text>
  <text x="350" y="185" class="small-label">(Q_len, embed_dim)</text>
  
  <rect x="300" y="220" width="100" height="60" class="lstm" />
  <text x="350" y="245" class="label">LSTM编码器</text>
  <text x="350" y="255" class="small-label">hidden_size</text>
  <text x="350" y="265" class="small-label">= 512</text>
  
  <!-- Attention Mechanism -->
  <text x="600" y="60" class="label">注意力机制</text>
  
  <rect x="500" y="150" width="120" height="40" class="attention" />
  <text x="560" y="175" class="label">图像注意力权重</text>
  <text x="560" y="185" class="small-label">α_t = softmax(e_t)</text>
  
  <rect x="650" y="150" width="120" height="40" class="attention" />
  <text x="710" y="175" class="label">问题注意力权重</text>
  <text x="710" y="185" class="small-label">β_i = softmax(f_i)</text>
  
  <rect x="575" y="220" width="120" height="60" class="attention" />
  <text x="635" y="245" class="label">加权特征融合</text>
  <text x="635" y="255" class="small-label">c_img = Σ α_t * h_t</text>
  <text x="635" y="265" class="small-label">c_que = Σ β_i * q_i</text>
  
  <!-- Feature Fusion -->
  <rect x="350" y="320" width="150" height="60" class="fusion" />
  <text x="425" y="345" class="label">多模态特征融合</text>
  <text x="425" y="355" class="small-label">f_fused = [c_img; c_que]</text>
  <text x="425" y="365" class="small-label">+ 非线性变换</text>
  
  <!-- Classification Head -->
  <rect x="350" y="420" width="150" height="40" class="output" />
  <text x="425" y="445" class="label">分类器</text>
  <text x="425" y="455" class="small-label">Linear + Dropout</text>
  
  <rect x="350" y="490" width="150" height="40" class="output" />
  <text x="425" y="515" class="label">答案概率分布</text>
  <text x="425" y="525" class="small-label">(vocab_size,)</text>
  
  <!-- Arrows for Image Branch -->
  <line x1="100" y1="120" x2="100" y2="145" class="arrow" />
  <line x1="100" y1="190" x2="100" y2="215" class="arrow" />
  
  <!-- Arrows for Question Branch -->
  <line x1="350" y1="120" x2="350" y2="145" class="arrow" />
  <line x1="350" y1="190" x2="350" y2="215" class="arrow" />
  
  <!-- Arrows to Attention -->
  <line x1="150" y1="250" x2="495" y2="170" class="arrow" />
  <line x1="400" y1="250" x2="645" y2="170" class="arrow" />
  
  <!-- Attention to Fusion -->
  <line x1="560" y1="190" x2="425" y2="315" class="arrow" />
  <line x1="710" y1="190" x2="425" y2="315" class="arrow" />
  <line x1="635" y1="280" x2="425" y2="315" class="arrow" />
  
  <!-- Classification Flow -->
  <line x1="425" y1="380" x2="425" y2="415" class="arrow" />
  <line x1="425" y1="460" x2="425" y2="485" class="arrow" />
  
  <!-- Detailed Attention Computation -->
  <rect x="50" y="350" width="200" height="120" class="attention" rx="5" />
  <text x="150" y="370" class="label">注意力计算详情</text>
  <text x="60" y="390" class="small-label">图像注意力:</text>
  <text x="60" y="405" class="small-label">e_t = MLP(h_img_t, h_que_final)</text>
  <text x="60" y="420" class="small-label">α_t = softmax(e_t)</text>
  <text x="60" y="440" class="small-label">问题注意力:</text>
  <text x="60" y="455" class="small-label">f_i = MLP(q_i, h_img_final)</text>
  
  <!-- Model Parameters -->
  <rect x="650" y="350" width="200" height="150" class="fusion" rx="5" />
  <text x="750" y="370" class="label">模型参数</text>
  <text x="660" y="390" class="small-label">• 词汇表大小: vocab_size</text>
  <text x="660" y="405" class="small-label">• 嵌入维度: embed_dim</text>
  <text x="660" y="420" class="small-label">• LSTM隐藏层: 512</text>
  <text x="660" y="435" class="small-label">• CNN特征维度: 512</text>
  <text x="660" y="450" class="small-label">• 注意力维度: 可配置</text>
  <text x="660" y="465" class="small-label">• Dropout率: 0.5</text>
  <text x="660" y="480" class="small-label">• 输出类别数: vocab_size</text>
  
  <!-- Data Flow Legend -->
  <text x="50" y="580" class="small-label">数据流说明:</text>
  <line x1="50" y1="600" x2="80" y2="600" class="arrow" />
  <text x="90" y="605" class="small-label">主要数据流</text>
  <line x1="200" y1="600" x2="230" y2="600" class="data-flow" />
  <text x="240" y="605" class="small-label">注意力连接</text>
  
  <!-- Loss Function -->
  <rect x="350" y="560" width="150" height="40" class="output" />
  <text x="425" y="585" class="label">损失函数: CrossEntropyLoss</text>
  
  <line x1="425" y1="530" x2="425" y2="555" class="arrow" />
</svg>